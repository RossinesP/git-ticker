# GitLab Ticker

A Python project for tracking and analyzing GitLab repositories using Domain-Driven Development (DDD) architecture.

## Overview

GitLab Ticker is designed to provide tools and services for working with GitLab repositories, including validation utilities and analysis capabilities. The project follows a clean architecture pattern with clear separation of concerns.

## Features

### Current Features

- **AI-Powered Commit Summarization**: Generate detailed markdown summaries for commits using LLM agents:
  - Processes commits in a range (from commit A to commit B)
  - Generates one markdown file per commit in a dedicated directory
  - Files are named with sequence number and commit hash for easy ordering and identification

## Requirements

- Python 3.12+
- Poetry (for dependency management)
- Git (for repository operations)

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd gitlab-ticker
```

2. Install dependencies using Poetry:
```bash
poetry install
```

3. Activate the virtual environment:
```bash
poetry shell
```

## Usage

### Commit Validation and Summarization Script

The `validate_commits.py` script validates git repository parameters and optionally generates AI-powered commit summaries:

```bash
python validate_commits.py <repo_path> <branch_name> <commit_a> [commit_b] [--output OUTPUT_DIR] [--skip-summarization] [--skip-empty-merges]
```

**Parameters:**
- `repo_path`: Path to the git repository directory
- `branch_name`: Name of the branch to validate
- `commit_a`: Hash of the older commit (commit A)
- `commit_b`: (Optional) Hash of the newer commit (commit B). If not provided, defaults to the latest commit on the specified branch
- `--output`, `-o`: (Optional) Output directory path where commit summaries will be saved. Defaults to `./output`
- `--skip-summarization`: (Optional) Skip summarization and only validate parameters
- `--skip-empty-merges`: (Optional) Skip merge commits that contain no file changes. When enabled, merge commits without modifications are excluded from summarization, reducing output size and focusing on commits with actual code changes.

**Commit Summarization:**
When summarization is enabled (default), the script generates detailed markdown summaries for each commit in the range:
- Creates a `commits_summaries/` directory in the output directory
- Generates one markdown file per commit with the format: `{sequence:04d}_{commit_hash[:8]}.md`
  - Example: `0001_a1b2c3d4.md`, `0002_b2c3d4e5.md`, etc.
- Sequence numbers start at 1 and correspond to the commit order in the branch (oldest to newest)
- When `--skip-empty-merges` is used, filtered commits are excluded and sequence numbers are recalculated to maintain continuous numbering
- Each file contains the full markdown summary generated by the LLM agent

**Example:**
```bash
# Validate and generate summaries
python validate_commits.py /path/to/repo main abc123 def456

# Specify custom output directory
python validate_commits.py /path/to/repo main abc123 def456 --output ./my_summaries

# Skip empty merge commits (merge commits with no file changes)
python validate_commits.py /path/to/repo main abc123 def456 --skip-empty-merges

# Only validate without generating summaries
python validate_commits.py /path/to/repo main abc123 --skip-summarization
```

**Exit Codes:**
- `0`: All parameters are valid (and summaries generated if not skipped)
- `1`: Validation failed or summarization error with error message

## Project Structure

The project follows a Domain-Driven Development (DDD) architecture:

```
gitlab_ticker/
  <domain_name>/
    domain/          # Domain entities and value objects
    repositories/    # Repository interfaces and implementations
    services/        # Business services
```

See `.cursorrules` for detailed architecture guidelines.

## Development

### Using Poetry

- Install dependencies: `poetry install`
- Add a dependency: `poetry add <package>`
- Add a development dependency: `poetry add --group dev <package>`
- Activate virtual environment: `poetry shell`
- Run commands in virtual environment: `poetry run <command>`
- Update dependencies: `poetry update`

### Code Standards

- All code, documentation, and comments must be in English
- Follow DDD architecture principles
- Write unit tests for domains, repositories, and services
- Keep README.md updated when adding new features
- **All code must be fully typed** with type hints (annotations)

### Code Quality Tools

The project uses **mypy** for type checking and **ruff** for linting and code formatting.

#### Type Checking with mypy

Check type correctness:
```bash
poetry run mypy .
```

All code must pass mypy type checks before committing. The project is configured with strict type checking enabled.

#### Linting and Formatting with ruff

Check code quality and style:
```bash
poetry run ruff check .
```

Format code:
```bash
poetry run ruff format .
```

**Important**: Every code change must be validated by both mypy and ruff before completion. Fix all errors and warnings before committing code.

## License

[Add license information here]

## Authors

- Pierre Rossin√®s <pierre.rossines@gmail.com>

